<!DOCTYPE html>
<html>
<head>
    <title>Story Creator</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }
        button {
            background: #0088cc;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #0077bb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì± –°–æ–∑–¥–∞–Ω–∏–µ Story</h1>
        <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å Story</p>
        
        <button onclick="createStory()">üé¨ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å Story</button>
        
        <div id="status"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        tg.expand();
        tg.MainButton.setText("–ì–æ—Ç–æ–≤–æ");
        tg.MainButton.hide();

        function createStory() {
            // –ü–æ–ª—É—á–∞–µ–º file_id –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL
            const urlParams = new URLSearchParams(window.location.search);
            const fileId = urlParams.get('file_id');
            
            try {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä Stories
                tg.openStoryEditor({
                    media: {
                        type: "photo",  // –∏–ª–∏ "video"
                        file: fileId    // file_id –∏–∑ –±–æ—Ç–∞
                    },
                    caption: "–ü—Ä–æ–º–æ–∫–æ–¥—ã Sora 2 üéüÔ∏è",
                    onDone: (result) => {
                        document.getElementById('status').innerHTML = 
                            '<p style="color: green;">‚úÖ Story –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞!</p>';
                        
                        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç
                        tg.sendData(JSON.stringify({
                            action: "story_published",
                            story_id: result.story_id,
                            file_id: fileId
                        }));
                        
                        tg.MainButton.show();
                    },
                    onCancel: () => {
                        document.getElementById('status').innerHTML = 
                            '<p style="color: orange;">‚ùå –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞</p>';
                    }
                });
            } catch (error) {
                document.getElementById('status').innerHTML = 
                    '<p style="color: red;">‚ùå –û—à–∏–±–∫–∞: ' + error.message + '</p>';
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ì–æ—Ç–æ–≤–æ"
        tg.MainButton.onClick(() => {
            tg.close();
        });
    </script>
</body>
</html>